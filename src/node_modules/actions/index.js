import {
  FETCH_GUITARS_START,
  FETCH_GUITARS_SUCCESS,
  FETCH_GUITARS_FAILURE,
  LOAD_MORE_GUITARS_START,
  LOAD_MORE_GUITARS_SUCCESS,
  LOAD_MORE_GUITARS_FAILURE
} from 'actionTypes';
import {getRenderedGuitarsLength} from 'selectors';
import {
  fetchGuitars as fetchGuitarsApi,
  loadMoreGuitars as loadMoreGuitarsApi
} from 'api';

export const fetchGuitars = () => async dispatch => {
  dispatch({type: FETCH_GUITARS_START});
  try {
     const guitars = await fetchGuitarsApi();
     dispatch({
       type: FETCH_GUITARS_SUCCESS,
       payload: guitars
      });
  } catch (err) {
    dispatch({
      type: FETCH_GUITARS_FAILURE,
      payload: err,
      error: true
    });
  }
}

export const loadMoreGuitars = () => async (dispatch, getState) => {
  const offset = getRenderedGuitarsLength(getState());
  dispatch({type: LOAD_MORE_GUITARS_START});
  try {
     const guitars = await loadMoreGuitarsApi({offset});
     dispatch({
       type: LOAD_MORE_GUITARS_SUCCESS,
       payload: guitars
      });
  } catch (err) {
    dispatch({
      type: LOAD_MORE_GUITARS_FAILURE,
      payload: err,
      error: true
    });
  }
}